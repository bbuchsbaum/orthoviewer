% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ortho_proxy.R
\name{ortho_proxy}
\alias{ortho_proxy}
\alias{OrthoViewerProxy}
\title{Proxy object for controlling an orthogonal viewer from Shiny}
\usage{
ortho_proxy(outputId, session = shiny::getDefaultReactiveDomain())
}
\arguments{
\item{outputId}{The id of the \code{ortho_viewer} widget in the UI.}

\item{session}{The Shiny session; defaults to the current reactive domain.}
}
\value{
An \code{OrthoViewerProxy} object with methods for controlling
the viewer. All methods return the proxy invisibly for chaining.
}
\description{
The proxy sends lightweight JSON messages from R to the browser,
where the JavaScript htmlwidget binding translates them into viewer
operations (adding layers, changing window/threshold/colormap, etc.).

An R6 class that provides methods for controlling an ortho_viewer widget
from Shiny server code. Created via \code{\link{ortho_proxy}()}.
}
\section{Proxy Methods}{

\describe{
\item{\code{add_layer(vol, id, thresh, range, colormap, opacity)}}{
Add a new overlay layer to the viewer.
}
\item{\code{set_window(range, layer_id)}}{
Set the display window (intensity range) for a layer.
}
\item{\code{set_threshold(thresh, layer_id)}}{
Set the threshold range for a layer.
}
\item{\code{set_colormap(colormap, layer_id)}}{
Set the colormap for a layer.
}
\item{\code{set_opacity(alpha, layer_id)}}{
Set the opacity for a layer.
}
\item{\code{set_crosshair(x, y, z, animate, duration)}}{
Set the crosshair position in world coordinates.
}
\item{\code{get_crosshair(request_id)}}{
Request the current crosshair position.
}
\item{\code{show_layer(layer_id)}}{
Make a layer visible.
}
\item{\code{hide_layer(layer_id)}}{
Hide a layer.
}
\item{\code{set_layer_visible(layer_id, visible)}}{
Set layer visibility explicitly.
}
\item{\code{set_layer_order(layer_ids)}}{
Reorder layers in the stack.
}
\item{\code{remove_layer(layer_id)}}{
Remove a layer from the viewer.
}
\item{\code{get_layers(request_id)}}{
Request a list of all layers.
}
}
}

\section{Crosshair Navigation}{

The \code{set_crosshair()} method allows programmatic navigation to any
world coordinate. Coordinates are in millimeters relative to the volume's
origin. The optional \code{animate} parameter enables smooth transitions.

The \code{get_crosshair()} method is asynchronous - it sends a request to
the browser and the result is returned via a Shiny input. Access the
result through \code{input$<outputId>_crosshair_response}.
}

\section{Layer Control}{

Layers are identified by their \code{layer_id} string, which is assigned
when adding a layer via \code{add_layer()}. The background layer always
has the id \code{"background"}.

Layer ordering determines which layers appear on top. Use
\code{set_layer_order()} with a character vector of layer IDs, where
the first element is at the bottom and the last is on top.
}

\examples{
\dontrun{
# In a Shiny server function:
server <- function(input, output, session) {
  output$viewer <- renderOrtho_viewer({
    ortho_viewer(brain_volume, bg_colormap = "Greys")
  })

  # Add an overlay layer
  observe({
    p <- ortho_proxy("viewer", session)
    p$add_layer(stat_map, id = "activation",
                thresh = c(-3, 3), colormap = "hot")
  })

  # Navigate to a coordinate when button is clicked
  observeEvent(input$go_to_peak, {
    p <- ortho_proxy("viewer", session)
    p$set_crosshair(c(32, -20, 45), animate = TRUE, duration = 500)
  })

  # Toggle layer visibility
  observeEvent(input$toggle_activation, {
    p <- ortho_proxy("viewer", session)
    if (input$show_activation) {
      p$show_layer("activation")
    } else {
      p$hide_layer("activation")
    }
  })
}
}
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{id}}{The output ID of the viewer widget.}

\item{\code{session}}{The Shiny session object.}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-OrthoViewerProxy-new}{\code{OrthoViewerProxy$new()}}
\item \href{#method-OrthoViewerProxy-add_layer}{\code{OrthoViewerProxy$add_layer()}}
\item \href{#method-OrthoViewerProxy-set_window}{\code{OrthoViewerProxy$set_window()}}
\item \href{#method-OrthoViewerProxy-set_threshold}{\code{OrthoViewerProxy$set_threshold()}}
\item \href{#method-OrthoViewerProxy-set_colormap}{\code{OrthoViewerProxy$set_colormap()}}
\item \href{#method-OrthoViewerProxy-set_opacity}{\code{OrthoViewerProxy$set_opacity()}}
\item \href{#method-OrthoViewerProxy-set_crosshair}{\code{OrthoViewerProxy$set_crosshair()}}
\item \href{#method-OrthoViewerProxy-get_crosshair}{\code{OrthoViewerProxy$get_crosshair()}}
\item \href{#method-OrthoViewerProxy-show_layer}{\code{OrthoViewerProxy$show_layer()}}
\item \href{#method-OrthoViewerProxy-hide_layer}{\code{OrthoViewerProxy$hide_layer()}}
\item \href{#method-OrthoViewerProxy-set_layer_visible}{\code{OrthoViewerProxy$set_layer_visible()}}
\item \href{#method-OrthoViewerProxy-set_layer_order}{\code{OrthoViewerProxy$set_layer_order()}}
\item \href{#method-OrthoViewerProxy-remove_layer}{\code{OrthoViewerProxy$remove_layer()}}
\item \href{#method-OrthoViewerProxy-get_layers}{\code{OrthoViewerProxy$get_layers()}}
\item \href{#method-OrthoViewerProxy-clone}{\code{OrthoViewerProxy$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-new"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-new}{}}}
\subsection{Method \code{new()}}{
Create a new OrthoViewerProxy object.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$new(id, session = shiny::getDefaultReactiveDomain())}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{id}}{The output ID of the ortho_viewer widget.}

\item{\code{session}}{The Shiny session object.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-add_layer"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-add_layer}{}}}
\subsection{Method \code{add_layer()}}{
Add a new overlay layer to the viewer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$add_layer(
  vol,
  id = NULL,
  thresh = c(0, 0),
  range = NULL,
  colormap = "viridis",
  opacity = 1
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{vol}}{Volume data - can be a 3D array or a neuroim2 NeuroVol object.}

\item{\code{id}}{Character string: unique identifier for this layer. If NULL,
a timestamp-based ID is generated.}

\item{\code{thresh}}{Numeric vector of length 2: threshold range c(low, high).
Voxels with values between low and high are made transparent.
Use c(0, 0) for no thresholding.}

\item{\code{range}}{Numeric vector of length 2: display range c(min, max) for
colormap scaling. If NULL, the volume's data range is used.}

\item{\code{colormap}}{Character string: name of the colormap to use.
Options include "viridis", "hot", "cool", "Greys", "RdBu", etc.}

\item{\code{opacity}}{Numeric: layer opacity from 0 (transparent) to 1 (opaque).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_window"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_window}{}}}
\subsection{Method \code{set_window()}}{
Set the display window (intensity range) for a layer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_window(range, layer_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{range}}{Numeric vector of length 2: c(min, max) intensity values
that map to the colormap endpoints.}

\item{\code{layer_id}}{Character string: the layer to modify. If NULL,
modifies the most recently added layer.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_threshold"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_threshold}{}}}
\subsection{Method \code{set_threshold()}}{
Set the threshold range for a layer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_threshold(thresh, layer_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{thresh}}{Numeric vector of length 2: c(low, high). Voxels with
values between low and high are made transparent.}

\item{\code{layer_id}}{Character string: the layer to modify. If NULL,
modifies the most recently added layer.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_colormap"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_colormap}{}}}
\subsection{Method \code{set_colormap()}}{
Set the colormap for a layer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_colormap(colormap, layer_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{colormap}}{Character string: name of the colormap.}

\item{\code{layer_id}}{Character string: the layer to modify. If NULL,
modifies the most recently added layer.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_opacity"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_opacity}{}}}
\subsection{Method \code{set_opacity()}}{
Set the opacity for a layer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_opacity(alpha, layer_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{alpha}}{Numeric: opacity value from 0 (transparent) to 1 (opaque).}

\item{\code{layer_id}}{Character string: the layer to modify. If NULL,
modifies the most recently added layer.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_crosshair"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_crosshair}{}}}
\subsection{Method \code{set_crosshair()}}{
Set the crosshair position (navigate to coordinates).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_crosshair(
  x,
  y = NULL,
  z = NULL,
  animate = FALSE,
  duration = 500
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{x}}{Numeric: X coordinate in world/mm space. Can also be a numeric
vector of length 3 containing c(x, y, z).}

\item{\code{y}}{Numeric: Y coordinate (ignored if x is a length-3 vector).}

\item{\code{z}}{Numeric: Z coordinate (ignored if x is a length-3 vector).}

\item{\code{animate}}{Logical: if TRUE, smoothly animate the transition.}

\item{\code{duration}}{Integer: animation duration in milliseconds (default 500).}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-get_crosshair"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-get_crosshair}{}}}
\subsection{Method \code{get_crosshair()}}{
Request the current crosshair position.

This is an asynchronous operation. The result will be sent to
\code{input$<outputId>_crosshair_response} as a list containing:
\itemize{
\item \code{world}: numeric vector c(x, y, z) in mm
\item \code{voxel}: integer vector c(i, j, k) voxel indices
\item \code{request_id}: the request_id if provided
\item \code{timestamp}: JavaScript timestamp
}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$get_crosshair(request_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{request_id}}{Optional identifier to match request with response.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-show_layer"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-show_layer}{}}}
\subsection{Method \code{show_layer()}}{
Make a layer visible.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$show_layer(layer_id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{layer_id}}{Character string: the layer ID to show.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-hide_layer"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-hide_layer}{}}}
\subsection{Method \code{hide_layer()}}{
Hide a layer (make invisible).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$hide_layer(layer_id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{layer_id}}{Character string: the layer ID to hide.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_layer_visible"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_layer_visible}{}}}
\subsection{Method \code{set_layer_visible()}}{
Set layer visibility.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_layer_visible(layer_id, visible)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{layer_id}}{Character string: the layer ID.}

\item{\code{visible}}{Logical: TRUE to show, FALSE to hide.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-set_layer_order"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-set_layer_order}{}}}
\subsection{Method \code{set_layer_order()}}{
Reorder layers in the stack.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$set_layer_order(layer_ids)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{layer_ids}}{Character vector of layer IDs in the desired order.
The first element will be at the bottom (rendered first), and the
last element will be on top (rendered last). The background layer
ID is typically "background".}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-remove_layer"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-remove_layer}{}}}
\subsection{Method \code{remove_layer()}}{
Remove a layer from the viewer.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$remove_layer(layer_id)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{layer_id}}{Character string: the layer ID to remove.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-get_layers"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-get_layers}{}}}
\subsection{Method \code{get_layers()}}{
Request a list of all layers.

This is an asynchronous operation. The result will be sent to
\code{input$<outputId>_layers_response} as a list containing:
\itemize{
\item \code{layers}: list of layer info (id, visible, opacity, index)
\item \code{request_id}: the request_id if provided
\item \code{timestamp}: JavaScript timestamp
}
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$get_layers(request_id = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{request_id}}{Optional identifier to match request with response.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
The proxy object invisibly (for method chaining).
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-OrthoViewerProxy-clone"></a>}}
\if{latex}{\out{\hypertarget{method-OrthoViewerProxy-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{OrthoViewerProxy$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
